<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Member Profile - FitZone</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Poppins:wght@600;700;900&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family:'Roboto',sans-serif;
            background:linear-gradient(135deg,#0f0f1e,#1a1a3e);
            color:#fff;
            min-height:100vh;
            padding:20px;
        }

        .container { max-width:1100px; margin:auto; }

        .back-link {
            display:inline-block;
            margin-bottom:30px;
            padding:12px 25px;
            background:rgba(255,107,53,.2);
            border:1px solid #ff6b35;
            color:#ff6b35;
            border-radius:8px;
            text-decoration:none;
            font-weight:bold;
        }
        .back-link:hover { background:#ff6b35;color:#fff }

        header {
            text-align:center;
            margin-bottom:40px;
            border-bottom:3px solid #ff6b35;
            padding-bottom:20px;
        }

        h1 {
            font-size:2.5em;
            color:#ff6b35;
            font-family:'Poppins',sans-serif;
        }

        .member-avatar {
            width:120px;height:120px;border-radius:50%;
            background:linear-gradient(135deg,#ff6b35,#ff8560);
            display:flex;align-items:center;justify-content:center;
            font-size:3em;margin:20px auto;
        }

        .action-btns {
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:15px;
            margin-bottom:40px;
        }

        .btn-primary {
            padding:15px;
            background:linear-gradient(135deg,#ff6b35,#ff8560);
            border:none;border-radius:8px;
            color:#fff;font-weight:bold;
            cursor:pointer;text-align:center;
            text-decoration:none;
            transition:all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform:translateY(-2px);
            box-shadow:0 8px 20px rgba(255,107,53,0.4);
        }
        
        .btn-primary.remove-btn {
            background:linear-gradient(135deg,#ff4343,#ff6666);
        }
        
        .btn-primary.remove-btn:hover {
            box-shadow:0 8px 20px rgba(255,67,67,0.4);
        }

        .profile-grid {
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:30px;
            margin-bottom:40px;
        }

        .card, .section {
            background:rgba(255,255,255,.08);
            border:1px solid rgba(255,107,53,.3);
            border-radius:15px;
            padding:25px;
            margin-bottom:30px;
        }

        .card h3, .section h4 {
            color:#ff6b35;
            margin-bottom:20px;
        }

        .info-row {
            display:flex;
            justify-content:space-between;
            padding:10px 0;
            border-bottom:1px solid rgba(255,107,53,.15);
        }

        .recent-list { display:flex;flex-direction:column;gap:10px }

        .list-item {
            display:flex;justify-content:space-between;
            padding:12px;background:rgba(0,0,0,.3);
            border-radius:8px;
        }

        footer {
            text-align:center;
            padding:30px 0;
            color:#a0a0a0;
            border-top:2px solid rgba(255,107,53,.3);
        }

        @media(max-width:768px){
            .profile-grid,.action-btns{grid-template-columns:1fr}
            h1{font-size:1.8em}
        }
    </style>
</head>
<body>
<div class="container">

    <a href="/" class="back-link">‚Üê Back to Dashboard</a>

    {% if member %}
    <header>
        <h1>üí™ {{ member[1] }}'s Profile</h1>
        <div class="member-avatar">{{ member[1][0].upper() }}</div>
    </header>

    <!-- QUICK ACTIONS -->
    <div class="action-btns">
        <a href="/attendance/{{ member[0] }}" class="btn-primary">‚úÖ Mark Attendance</a>
        <a href="#add-fee" class="btn-primary">üí≥ Add Fee</a>
        <a href="#weight-section" class="btn-primary" style="grid-column:span 1;">‚öñÔ∏è Track Weight</a>
        <button class="btn-primary remove-btn" onclick="if(confirm('Are you sure you want to remove this member from the gym?')) { document.getElementById('removeMemberForm').submit(); }">üóëÔ∏è Remove Member</button>
    </div>
    
    <!-- Hidden form for removing member -->
    <form id="removeMemberForm" action="/remove-member/{{ member[0] }}" method="POST" style="display:none;"></form>

    <!-- MEMBER INFO -->
    <div class="profile-grid">
        <div class="card">
            <h3>üìã Personal Info</h3>
            <div class="info-row"><span>Name</span><span>{{ member[1] }}</span></div>
            <div class="info-row"><span>Phone</span><span>{{ member[2] or '‚Äî' }}</span></div>
            <div class="info-row"><span>Email</span><span>{{ member[3] or '‚Äî' }}</span></div>
            <div class="info-row"><span>Joined</span><span>{{ member[4] }}</span></div>
            <div class="info-row"><span>Status</span><span>{{ member[6] }}</span></div>
        </div>

        <div class="card">
            <h3>üìä Attendance Stats</h3>
            {% for s,c in attendance_data %}
            <div class="info-row"><span>{{ s }}</span><span>{{ c }} days</span></div>
            {% else %}
            <p style="color:#a0a0a0;">No attendance data</p>
            {% endfor %}
        </div>
    </div>

    <!-- ADD FEE SECTION (IMPORTANT ADDITION) -->
    <div class="section" id="add-fee">
        <h4>‚ûï Add New Fee</h4>

        <form method="POST" action="/add-fees" style="display:flex;gap:15px;flex-wrap:wrap;">
            <input type="hidden" name="member_id" value="{{ member[0] }}">

            <input
                type="number"
                name="amount"
                placeholder="Enter fee amount (‚Çπ)"
                required
                style="padding:12px;border-radius:8px;border:1px solid rgba(255,107,53,.4);
                       background:rgba(0,0,0,.3);color:#fff;min-width:200px;"
            >

            <button type="submit" class="btn-primary">üí∞ Add Fee</button>
        </form>

        <p style="color:#a0a0a0;margin-top:10px;font-size:.9em;">
            Next due date will be auto set (30 days)
        </p>
    </div>

    <!-- PAYMENT HISTORY & STATUS -->
    {% if fees %}
    <div class="section">
        <h4>üí≥ Payment History & Status</h4>
        <div class="recent-list">
            {% for fee in fees %}
            <div class="list-item" style="justify-content:space-between;align-items:center;
                {% if fee[5] == 'pending' %}
                    border-left:4px solid #ffc107;background:rgba(255,193,7,.15);
                {% elif fee[5] == 'paid' %}
                    border-left:4px solid #4caf50;
                {% endif %}
            ">
                <div>
                    <span style="display:block;color:#ff6b35;font-weight:bold;">‚Çπ{{ fee[2]|int }}</span>
                    <span style="display:block;color:#a0a0a0;font-size:0.9em;">Due: {{ fee[4] }}</span>
                </div>
                <div style="text-align:right;">
                    <span style="display:block;padding:5px 12px;border-radius:6px;
                        {% if fee[5] == 'pending' %}
                            background:#ffc107;color:#000;font-weight:bold;
                        {% else %}
                            background:#4caf50;color:#fff;font-weight:bold;
                        {% endif %}
                    ">{{ fee[5]|upper }}</span>
                    {% if fee[5] == 'pending' %}
                    <form action="/pay-fees/{{ member[0] }}" method="POST" style="margin-top:8px;">
                        <button type="submit" class="btn-primary" style="padding:6px 12px;font-size:0.85em;">‚úÖ Mark Paid</button>
                    </form>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="section">
        <h4>üí≥ Payment History</h4>
        <p style="color:#a0a0a0;text-align:center;">No fees added yet</p>
    </div>
    {% endif %}

    <!-- WEIGHT TRACKING SECTION -->
    <div class="section" id="weight-section">
        <h4>‚öñÔ∏è Weight Tracking & Progress</h4>
        
        <!-- Add Weight Form -->
        <form method="POST" action="/add-weight" style="display:flex;gap:15px;flex-wrap:wrap;margin-bottom:25px;">
            <input type="hidden" name="member_id" value="{{ member[0] }}">
            
            <input
                type="number"
                name="weight"
                placeholder="Enter weight (kg)"
                step="0.5"
                required
                style="padding:12px;border-radius:8px;border:1px solid rgba(255,107,53,.4);
                       background:rgba(0,0,0,.3);color:#fff;min-width:150px;"
            >
            
            <button type="submit" class="btn-primary">‚ûï Log Weight</button>
        </form>

        <!-- Weight History -->
        {% if weight_logs %}
        <div style="background:rgba(0,0,0,.2);border-radius:10px;padding:15px;">
            <h5 style="color:#ff6b35;margin-bottom:15px;">üìä Weight History</h5>
            <div class="recent-list">
                {% set start_weight = member[5] %}
                {% for log in weight_logs %}
                    {% set difference = log[1] - start_weight %}
                    {% set status = 'üìâ Lost' if difference < 0 else 'üìà Gained' if difference > 0 else '‚úÖ Same' %}
                    <div class="list-item" style="justify-content:space-between;align-items:center;border-left:4px solid {% if difference < 0 %}#4caf50{% elif difference > 0 %}#ff6b35{% else %}#ffc107{% endif %};">
                        <div>
                            <span style="display:block;color:#fff;font-weight:bold;">{{ log[0] }}</span>
                            <span style="display:block;color:#a0a0a0;font-size:0.9em;">Weight: {{ log[1] }} kg</span>
                        </div>
                        <div style="text-align:right;">
                            <span style="display:block;font-weight:bold;color:{% if difference < 0 %}#4caf50{% elif difference > 0 %}#ff6b35{% else %}#ffc107{% endif %};">{{ status }} {{ difference|abs }} kg</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <p style="color:#a0a0a0;text-align:center;">No weight logs yet. Start tracking now!</p>
        {% endif %}

        <!-- Weight Summary -->
        {% if weight_logs %}
        <div style="background:rgba(255,107,53,.1);border-radius:10px;padding:15px;margin-top:15px;">
            <h5 style="color:#ff6b35;margin-bottom:10px;">üìà Summary</h5>
            <div class="info-row" style="border:none;">
                <span>Starting Weight</span>
                <span style="color:#ff6b35;font-weight:bold;">{{ member[5] }} kg</span>
            </div>
            <div class="info-row" style="border:none;">
                <span>Current Weight</span>
                <span style="color:#ff6b35;font-weight:bold;">{{ weight_logs[0][1] }} kg</span>
            </div>
            <div class="info-row" style="border:none;">
                <span>Total Progress</span>
                {% set total_change = weight_logs[0][1] - member[5] %}
                <span style="color:{% if total_change < 0 %}#4caf50{% elif total_change > 0 %}#ff6b35{% else %}#ffc107{% endif %};font-weight:bold;">
                    {% if total_change < 0 %}üìâ -{{ total_change|abs }} kg{% elif total_change > 0 %}üìà +{{ total_change }} kg{% else %}‚úÖ No change{% endif %}
                </span>
            </div>
        </div>
        {% endif %}
    </div>

    <footer>
        <p>üí™ Consistency builds champions</p>
        <p>&copy; 2025 FitZone</p>
    </footer>

    {% else %}
    <p style="text-align:center;color:#a0a0a0;">Member not found</p>
    {% endif %}

</div>
</body>
</html>